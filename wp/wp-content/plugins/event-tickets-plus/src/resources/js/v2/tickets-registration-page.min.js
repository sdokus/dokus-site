/**
 * This JS file was auto-generated via Terser.
 *
 * Contributors should avoid editing this file, but instead edit the associated
 * non minified file file. For more information, check out our engineering docs
 * on how we handle JS minification in our engineering docs.
 *
 * @see: https://evnt.is/dev-docs-minification
 */

tribe.tickets=tribe.tickets||{},tribe.tickets.registration={},function($,obj){const $document=$(document);obj.selectors={container:".tribe-tickets__registration",eventContainer:".tribe-tickets__registration-event",form:"#tribe-tickets__registration-form",item:".tribe-tickets__tickets-item",itemPrice:".tribe-amount",itemQuantity:".tribe-ticket-quantity",itemTotal:".tribe-tickets__tickets-item-total .tribe-amount",footerQuantity:".tribe-tickets__tickets-footer-quantity-number",footerAmount:".tribe-tickets__tickets-footer-total .tribe-amount",checkoutButton:".tribe-tickets__registration-submit",metaForm:".tribe-tickets__registration-content",metaContainer:".tribe-tickets__attendee-tickets-container",metaContainerHasTickets:".tribe-tickets__attendee-tickets-container--has-tickets",metaItem:".tribe-tickets__attendee-tickets-item",miniCart:"#tribe-tickets__mini-cart"},obj.commerceSelector={edd:"Tribe__Tickets_Plus__Commerce__EDD__Main",rsvp:"Tribe__Tickets__RSVP",tpp:"Tribe__Tickets__Commerce__PayPal__Main",Tribe__Tickets__Commerce__PayPal__Main:"tribe-commerce",Tribe__Tickets__RSVP:"rsvp",Tribe__Tickets_Plus__Commerce__EDD__Main:"edd",Tribe__Tickets_Plus__Commerce__WooCommerce__Main:"woo",tribe_eddticket:"edd",tribe_tpp_attendees:"tpp",tribe_wooticket:"woo",woo:"Tribe__Tickets_Plus__Commerce__WooCommerce__Main"},obj.getTicketsForSave=function(){const tickets=[];let $cartForm=$(obj.selectors.miniCart);$cartForm.length||($cartForm=$(obj.selectors.container));return $cartForm.find(obj.selectors.item).each((function(){const $row=$(this),ticketId=$row.data("ticketId"),qty=$row.find(obj.selectors.itemQuantity).text(),data={};data.ticket_id=ticketId,data.quantity=qty,tickets.push(data)})),tickets},obj.initFormPreFills=function($container){const $miniCart=$container.find(obj.selectors.miniCart);tribe.tickets.loader.show($document),$.ajax({type:"GET",data:{provider:obj.providerId},cache:!1,dataType:"json",url:tribe.tickets.utils.getRestEndpoint(),success:function(data){data.tickets&&obj.preFillCartForm($miniCart,data.tickets),data.meta&&(obj.appendARFields($container,data),obj.preFillMetaForm($container,data),window.dispatchEvent(new Event("tribe_et_after_form_prefills")))},complete:function(){tribe.tickets.loader.hide($document)}})},obj.appendARFields=function($container,data){const tickets=data.tickets;let nonMetaCount=0,metaCount=0;const $tribeRegistration=$container;$.each(tickets,(function(index,ticket){const ticketTemplate=window.wp.template("tribe-registration--"+ticket.ticket_id),$ticketContainer=$tribeRegistration.find(obj.selectors.metaContainer+'[data-ticket-id="'+ticket.ticket_id+'"]');$ticketContainer.length?metaCount+=ticket.quantity:nonMetaCount+=ticket.quantity,$ticketContainer.addClass(obj.selectors.metaContainerHasTickets.className());let nthAttendee=0;for(let i=1;i<=ticket.quantity;++i){const datum={attendee_id:i};try{$ticketContainer.append(ticketTemplate(window.wp.hooks.applyFilters("tec.tickets-plus.ticket-getTemplateData",datum,ticket.ticket_id,nthAttendee))),nthAttendee++}catch(error){}}})),obj.maybeShowNonMetaNotice(nonMetaCount,metaCount)},obj.maybeShowNonMetaNotice=function(nonMetaCount,metaCount){const $notice=$(".tribe-tickets__notice--non-ar");0<nonMetaCount&&0<metaCount?($("#tribe-tickets__non-ar-count").text(nonMetaCount),$notice.removeClass("tribe-common-a11y-hidden")):$notice.addClass("tribe-common-a11y-hidden")},obj.preFillMetaForm=function($container,data,len){let length=len;if(void 0===data||0>=data.length)return;void 0===length&&(length=0);const $containers=$container.find(obj.selectors.metaContainer);let meta=data.meta;0<length&&(meta=meta.splice(0,length-1)),$.each(meta,(function(metaIndex,ticket){const $currentContainers=$containers.filter('[data-ticket-id="'+ticket.ticket_id+'"]'),$tempTextarea=$("<textarea />");if(!$currentContainers.length)return;let current=0;$.each(ticket.items,(function(ticketIndex,datum){if("object"!=typeof datum)return;const $ticketContainers=$currentContainers.find(obj.selectors.metaItem);$.each(datum,(function(index,value){$tempTextarea.html(value);const formattedValue=$tempTextarea.text(),$field=$ticketContainers.eq(current).find('[name*="'+index+'"]');$field.is(":radio")||$field.is(":checkbox")?$field.each((function(){const $item=$(this);formattedValue===$item.val()&&$item.prop("checked",!0)})):$field.val(formattedValue),$field.hasClass("tribe-tickets__form-field--birth-value")&&tribe.tickets.meta.populateFieldBirthday()})),current++}))}))},obj.updateFooter=function($form){obj.updateFooterCount($form),obj.updateFooterAmount($form)},obj.updateFooterCount=function($form){const $field=$form.find(obj.selectors.footerQuantity);let footerCount=0;$form.find(obj.selectors.itemQuantity).each((function(){let newQuantity=parseInt($(this).text(),10);newQuantity=isNaN(newQuantity)?0:newQuantity,footerCount+=newQuantity})),0>footerCount||$field.text(footerCount)},obj.updateFooterAmount=function($form){const $field=$form.find(obj.selectors.footerAmount);let footerAmount=0;const $quantities=$form.find(obj.selectors.itemQuantity),provider=$form.data("provider");$quantities.each((function(){const $qty=$(this),$ticketItem=$qty.closest(obj.selectors.item);let quantity=parseInt($qty.text(),10);quantity=isNaN(quantity)?0:quantity;const priceVal=tribe.tickets.utils.getPrice($ticketItem,provider),cost=parseFloat(priceVal)*quantity;footerAmount+=cost})),0>footerAmount||$field.text(tribe.tickets.utils.numberFormat(footerAmount,provider))},obj.preFillCartForm=function($form,tickets){const provider=$form.data("provider");$.each(tickets,(function(index,value){const $item=$form.find('[data-ticket-id="'+value.ticket_id+'"]');if($item){$item.find(obj.selectors.itemQuantity).html(value.quantity);const price=tribe.tickets.utils.getPrice($item,provider),totalPrice=value.quantity*price,formattedTotal=tribe.tickets.utils.numberFormat(totalPrice,provider);$item.find(obj.selectors.itemTotal).html(formattedTotal)}})),obj.updateFooter($form)},obj.bindSubmit=function($container){const $button=$container.find(obj.selectors.checkoutButton),ticketProvider=$container.data("provider");$button.on("click",(function(e){e.preventDefault();const $metaForm=$container.find(obj.selectors.metaForm),$metaFormItems=$metaForm.find(obj.selectors.metaItem),$errorNotice=$container.find(".tribe-tickets__notice--error"),isValidForm=tribe.tickets.meta.validateForm($metaForm);if(tribe.tickets.loader.show($document),!isValidForm[0])return $([document.documentElement,document.body]).animate({scrollTop:$(".tribe-tickets__registration").offset().top},"slow"),$(".tribe-tickets__notice--error__count").text(isValidForm[1]),$errorNotice.show(),tribe.tickets.loader.hide($document),!1;$errorNotice.hide();const params={tribe_tickets_provider:obj.commerceSelector[ticketProvider],tribe_tickets_tickets:obj.getTicketsForSave(),tribe_tickets_meta:tribe.tickets.data.getMetaForSave($metaFormItems)};$("#tribe_tickets_ar_data").val(JSON.stringify(params)),$(obj.selectors.form).submit()}))},obj.bindEvents=function($container){$document.trigger("beforeSetup.tribeTicketsRegistrationPage",[$container]),obj.bindSubmit($container),$document.trigger("afterSetup.tribeTicketsRegistrationPage",[$container])},obj.ready=function(){$(obj.selectors.container).each((function(index,block){obj.initFormPreFills($(block)),obj.bindEvents($(block))}))},$(obj.ready)}(jQuery,tribe.tickets.registration);